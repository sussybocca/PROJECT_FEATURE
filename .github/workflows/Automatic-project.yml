name: Auto Generate Repo

on:
  schedule:
    - cron: '* * * * *'  # every minute
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v3
        with:
          node-version: '20'

      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Build Realistic Project Generator
        run: |
          mkdir -p engine
          cat > engine/generator.js << 'EOF'
          const fs = require('fs');

          const languages = {
            js: { ext: 'js', main: 'index.js' },
            py: { ext: 'py', main: 'main.py' }
          };

          const projectTemplates = {
            calculator: {
              js: `
function add(a, b) { return a + b; }
function sub(a, b) { return a - b; }
function mul(a, b) { return a * b; }
function div(a, b) { return a / b; }

console.log("Add:", add(5,3));
console.log("Sub:", sub(5,3));
console.log("Mul:", mul(5,3));
console.log("Div:", div(5,3));
`,
              py: `
def add(a,b): return a+b
def sub(a,b): return a-b
def mul(a,b): return a*b
def div(a,b): return a/b

print("Add:", add(5,3))
print("Sub:", sub(5,3))
print("Mul:", mul(5,3))
print("Div:", div(5,3))
`
            },
            greeter: {
              js: `
function greet(name) { console.log("Hello, "+name+"!"); }
greet("World");
`,
              py: `
def greet(name): print(f"Hello, {name}!")
greet("World")
`
            },
            todo: {
              js: `
let todos = [];
function addTodo(task) { todos.push(task); }
function listTodos() { console.log(todos); }

addTodo("Buy milk");
addTodo("Walk dog");
listTodos();
`,
              py: `
todos = []
def add_todo(task): todos.append(task)
def list_todos(): print(todos)

add_todo("Buy milk")
add_todo("Walk dog")
list_todos()
`
            }
          };

          function pick(obj) {
            const keys = Object.keys(obj);
            return keys[Math.floor(Math.random()*keys.length)];
          }

          const lang = pick(languages);
          const template = pick(projectTemplates);
          const code = projectTemplates[template][lang];
          const id = Date.now();
          const root = `project_${lang}_${template}_${id}`;

          fs.mkdirSync(root, { recursive: true });
          fs.writeFileSync(`${root}/${languages[lang].main}`, code);
          fs.writeFileSync(`${root}/README.md`, `# Auto Generated Project\n\nLanguage: ${lang}\nTemplate: ${template}\nID: ${id}\n`);

          console.log(`Generated project at ${root}`);
          EOF

      - name: Generate New Project
        run: node engine/generator.js

      - name: Commit & Push
        run: |
          git config --global user.name "auto-bot"
          git config --global user.email "bot@example.com"
          git add .
          git commit -m "Auto-generated real project $(date)" || echo "No changes"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
